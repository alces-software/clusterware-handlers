---
install:
  _: |
    require files
    files_load_config clusterware
    case "${cw_VERSION:-1.0.0}" in
      1.[0123456789].*)
        echo "This handler cannot be enabled as Alces Clusterware v${cw_VERSION} is too old."
        echo "Please upgrade to Alces Clusterware v1.10.0 or higher."
        exit 1
        ;;
    esac
    alces service install forge
    alces handler enable cluster-nfs
    mkdir "/opt/forge"

    cat <<EOF > "${cw_ROOT}"/etc/cluster-nfs.d/cluster-gridware-docker.rc
    ################################################################################
    ##
    ## Alces Clusterware - Shell configuration
    ## Copyright (c) 2017 Alces Software Ltd
    ##
    ################################################################################
    if [ -d "/opt/forge" ]; then
        cw_CLUSTER_NFS_exports="\${cw_CLUSTER_NFS_exports} /opt/forge"
    fi
    EOF
