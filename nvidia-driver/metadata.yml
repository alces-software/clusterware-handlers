---
install:
  el6: |
    if ! rpm -q pciutils >/dev/null; then
        yum install -y -e0 pciutils
    fi
  el7: |
    if ! rpm -q pciutils >/dev/null; then
        yum install -y -e0 pciutils
    fi
  _: |
    if [ -z "$1" ]; then
        echo "Using default module: libs/nvidia-cuda"
        alces module load libs/nvidia-cuda
    else
        echo "Using supplied module: $1"
        alces module load $1
    fi
    if [ -z "${NVIDIA_CUDADIR}" ]; then
        echo "ERROR: unable to locate libs/nvidia-cuda module"
        exit 1
    fi
    if [ -z "$2" ]; then
      installer="${NVIDIA_CUDADRIVER_INSTALLER:-${NVIDIA_CUDADIR}/installers/devdriver.run}"
    else
      installer="$2"
    fi
    if [ ! -x "${installer}" ]; then
        echo "ERROR: installer could not be located: ${installer}"
        exit 1
    fi
    cat <<EOF > ${cw_ROOT}/etc/nvidia-driver.vars.sh
    cw_NVIDIA_DRIVER_installer=${installer}
    cw_NVIDIA_DRIVER_log=/var/log/clusterware/nvidia-driver.log
    EOF
